<svg
        xmlns='http://www.w3.org/2000/svg'
        xmlns:xlink='http://www.w3.org/1999/xlink'
        width='<%= getSvgSizeInProcentage('width') %>'
        height='<%= getSvgSizeInProcentage('height') %>'
        style='<%=`overflow: visible; filter: url(#shadow${currentSlide.position}${layer.position}); transform: translate(${getSvgTranslate()}em, ${getSvgTranslate()}em); width: calc(100% - ${(layer.settings.layerSettings.shapeStyles.thickness / 16).toFixed(1)}em); height: calc(100% - ${(layer.settings.layerSettings.shapeStyles.thickness / 16).toFixed(1)}em);`%>'
        viewBox='0 0 33 33'
        preserveAspectRatio='none'
>
    <defs>
        <filter id='<%=`shadow${currentSlide.position}${layer.position}`%>' width='200%' height='200%' x='-40%' y='-40%'>
            <%if (layer.settings.generalSettings.shadow !== '0') { %>
            <feDropShadow flood-opacity='<%=layer.settings.generalSettings.shadow == '0' ? '0' : '1'%>' dx='0' dy='0' stdDeviation='<%= layer.settings.generalSettings.shadow / 10 %>' />
            <% } else {%>
                <feDropShadow flood-opacity='0' dx='0' dy='0' stdDeviation='0' />
            <% } %>
        </filter>

        <linearGradient id='<%=`linearfillColor${currentSlide.position}${layer.position}`%>' x1="<%= setCoordinates('x1', 'fillColor') %>" y1="<%= setCoordinates('y1', 'fillColor') %>" x2="<%= setCoordinates('x2', 'fillColor') %>" y2="<%= setCoordinates('y2', 'fillColor') %>">
            <stop offset="<%=`${layer.settings.layerSettings.shapeStyles.fillColor.leftColorPercent || 0}%`%>" style="stop-color:<%=`${layer.settings.layerSettings.shapeStyles.fillColor.leftColor || 'rgba(255, 255, 255, 1)'};stop-opacity:1`%>"/>
            <stop offset="<%=`${layer.settings.layerSettings.shapeStyles.fillColor.rightColorPercent || 0}%`%>" style="stop-color:<%=`${layer.settings.layerSettings.shapeStyles.fillColor.rightColor || 'rgba(255, 255, 255, 1)'};stop-opacity:1`%>"/>
        </linearGradient>

        <radialGradient id='<%=`radialfillColor${currentSlide.position}${layer.position}`%>' cx="50%" cy="50%" r="100%" fx="<%=`${layer.settings.layerSettings.shapeStyles.fillColor.horizontalDirection || 0}%`%>" fy="<%=`${layer.settings.layerSettings.shapeStyles.fillColor.verticalDirection || 0}%`%>">
            <stop offset="<%=`${layer.settings.layerSettings.shapeStyles.fillColor.leftColorPercent || 0}%`%>" style="stop-color:<%=`${layer.settings.layerSettings.shapeStyles.fillColor.leftColor || 'rgba(255, 255, 255, 1)'};stop-opacity:1`%>"/>
            <stop offset="<%=`${layer.settings.layerSettings.shapeStyles.fillColor.rightColorPercent || 0}%`%>" style="stop-color:<%=`${layer.settings.layerSettings.shapeStyles.fillColor.rightColor || 'rgba(255, 255, 255, 1)'};stop-opacity:1`%>"/>
        </radialGradient>

        <linearGradient id='<%=`linearborderColor${currentSlide.position}${layer.position}`%>' x1="<%= setCoordinates('x1', 'borderColor') %>" y1="<%= setCoordinates('y1', 'borderColor') %>" x2="<%= setCoordinates('x2', 'borderColor') %>" y2="<%= setCoordinates('y2', 'borderColor') %>">
            <stop offset="<%=`${layer.settings.layerSettings.shapeStyles.borderColor.leftColorPercent || 0}%`%>" style="stop-color:<%=`${layer.settings.layerSettings.shapeStyles.borderColor.leftColor || 'rgba(255, 255, 255, 1)'};stop-opacity:1`%>"/>
            <stop offset="<%=`${layer.settings.layerSettings.shapeStyles.borderColor.rightColorPercent || 0}%`%>" style="stop-color:<%=`${layer.settings.layerSettings.shapeStyles.borderColor.rightColor || 'rgba(255, 255, 255, 1)'};stop-opacity:1`%>"/>
        </linearGradient>

        <radialGradient id='<%=`radialborderColor${currentSlide.position}${layer.position}`%>' cx="50%" cy="50%" r="100%" fx="<%=`${layer.settings.layerSettings.shapeStyles.borderColor.horizontalDirection || 0}%`%>" fy="<%=`${layer.settings.layerSettings.shapeStyles.borderColor.verticalDirection || 0}%`%>">
            <stop offset="<%=`${layer.settings.layerSettings.shapeStyles.borderColor.leftColorPercent || 0}%`%>" style="stop-color:<%=`${layer.settings.layerSettings.shapeStyles.borderColor.leftColor || 'rgba(255, 255, 255, 1)'};stop-opacity:1`%>"/>
            <stop offset="<%=`${layer.settings.layerSettings.shapeStyles.borderColor.rightColorPercent || 0}%`%>" style="stop-color:<%=`${layer.settings.layerSettings.shapeStyles.borderColor.rightColor || 'rgba(255, 255, 255, 1)'};stop-opacity:1`%>"/>
        </radialGradient>
    </defs>
    <g>
        <g transform='translate(-1059 -228.25)'>
            <use fill='transparent'/>
            <path
                    d='M1059 244.75a16.5 16.5 0 1 1 33 0 16.5 16.5 0 0 1-33 0z'
                    stroke='<%= setColor('borderColor') %>'
                    fill='<%= setColor('fillColor') %>'
                    stroke-width='<%= layer.settings.layerSettings.shapeStyles.thickness && +layer.settings.layerSettings.shapeStyles.thickness >= 0 ? `${(layer.settings.layerSettings.shapeStyles.thickness / 16).toFixed(3)}em` : 0 %>'
                    vector-effect='non-scaling-stroke'>
            </path>
        </g>
    </g>
</svg>

<%function getSvgSizeInProcentage(type) {
    return (100 * (layer.settings.layerSettings[type] + layer.settings.layerSettings.shapeStyles.thickness / 2)) /
            (layer.settings.layerSettings[type] + layer.settings.layerSettings.shapeStyles.thickness * 2) + '%';
} %>

<%function getSvgTranslate() {
    return ((layer.settings.layerSettings.shapeStyles.thickness / 2) / 16).toFixed(2);
} %>

<%function setColor(type) {
    if (layer.settings.layerSettings) {
        if (typeof layer.settings.layerSettings.shapeStyles[type] === 'string') {
            return layer.settings.layerSettings.shapeStyles[type]
        } else {
            return layer.settings.layerSettings.shapeStyles[type].type === 'solid' ? layer.settings.layerSettings.shapeStyles[type].leftColor :
                    `url(#${layer.settings.layerSettings.shapeStyles[type].type === 'linear' ? 'linear' : 'radial'}${type}${currentSlide.position}${layer.position})`
        }
    } else {
        return 'black'
    }
} %>

<%function setCoordinates(type, colorType) {
    if (isNaN(layer.settings.layerSettings.shapeStyles[colorType].angle)) {
        return 0
    }
    const anglePI = -layer.settings.layerSettings.shapeStyles[colorType].angle * (Math.PI / 180);
    switch (type) {
        case 'x1':
            return Math.round(50 + Math.sin(anglePI) * 50) + '%';
        case 'y1':
            return Math.round(50 + Math.cos(anglePI) * 50) + '%';
        case 'x2':
            return Math.round(50 + Math.sin(anglePI + Math.PI) * 50) + '%'
        case 'y2':
            return Math.round(50 + Math.cos(anglePI + Math.PI) * 50) + '%'
    }
} %>
